---
title: "R Notebook"
output: html_notebook
---

# Final Project

## Data cleaning

```{r, message=FALSE}
library(tidyverse)
library(janitor)
library(ggplot2)
library(infer)

```


```{r, message=FALSE}
# core data files
dist_blue_green <- read_csv("../raw_data/shs_dist_to_blue_or_green_space.csv") %>% clean_names()
neighbourhood_rating <- read_csv("../raw_data/shs_neighbourhood_raiting.csv") %>% clean_names()
comm_belong <- read_csv("../raw_data/shs_community_belonging.csv") %>% clean_names()

```

```{r}
glimpse(comm_belong)
glimpse(neighbourhood_rating)

```

```{r}
dist_blue_green %>% distinct(age)

```


```{r}
dist_model <- dist_blue_green %>% 
  filter(measurement == "Percent", age == "35-64 years", distance_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  select(feature_code, date_code, value, gender, age, distance_to_nearest_green_or_blue_space) %>%
  group_by(date_code) %>% 
  summarise(mean_prop = mean(value)) %>% 
  ggplot() +
  aes(x = date_code, y = mean_prop) +
  geom_line()

dist_model %>% distinct()

comm_model <- comm_belong %>% 
  filter(measurement == "Percent") %>% 
  select(feature_code, date_code, gender, community_belonging)

comm_model %>% distinct()

```


```{r}
dist_age_test <- dist_blue_green %>% 
  filter(measurement == "Percent", age != "All", distance_to_nearest_green_or_blue_space == "A 5 minute walk or less", date_code == 2013) %>% 
  select(date_code, feature_code, value, age)

dist_age_test %>% 
  group_by(age) %>% 
  summarise(mean_val = mean(value),
            sd_val = sd(value),
            min_val = min(value),
            max_val = max(value),
            sample = n())
```

Additional files and Extension topics:

```{r}
# additional files
data_zones <- read_csv("../raw_data/DataZone2011lookup_2022-05-05.csv") %>% clean_names() # Geography lookup tables 
derelict_urb_vacant <- read_csv("../raw_data/shs_derelict_and_urban_vacant_land.csv") %>% clean_names()
proximity_to_derelict <- read_csv("../raw_data/shs_population_living_in_close_proximity_to_a_derelict_site.csv") %>% clean_names()
```


Data cleaning/ wrangling: 

- harmonise variable names before df joins ("walking_time_to_nearest_green_or_blue_space" = "distance_to_nearest_green_or_blue_space");
- deselect "Units" column from joined dfs;
- make variable names more explicit (date code == year)


```{r}
dist_blue_green <- dist_blue_green %>% 
  rename("walking_time_to_nearest_green_or_blue_space" = "distance_to_nearest_green_or_blue_space") %>% 
  filter(measurement == "Percent")

neighbourhood_rating <- neighbourhood_rating %>% 
  rename("walking_time_to_nearest_green_or_blue_space" = "walking_distance_to_nearest_greenspace") %>% 
  filter(measurement == "Percent")

comm_belong <- comm_belong %>% 
  rename("walking_time_to_nearest_green_or_blue_space" = "walking_distance_to_nearest_greenspace") %>% 
  filter(measurement == "Percent")

```


```{r}
shs_data_join <- dist_blue_green %>% 
  full_join(neighbourhood_rating) %>% 
  full_join(comm_belong) %>% 
  select(-c(units, measurement)) %>% # deselect "Units" column
  rename("year" = "date_code")

```

```{r}
# joining with data zones table by la_code to have Local Authority names
data_zones_trim <- data_zones %>% 
  select(la_code, la_name) %>% 
  distinct()

shs_data_la_join <- shs_data_join %>% 
  left_join(data_zones_trim, by = c("feature_code" = "la_code")) %>% 
  mutate(la_name = if_else(feature_code == "S92000003", "Scotland", la_name)) 

# shs_data_la_join %>% filter(is.na(la_name)) %>% distinct(feature_code) # sense check for any missing la_name vals and associated feature_code

shs_data_clean <- shs_data_la_join # re-assigning cleaned data to explicity object

```

Write clean data to file at clean data folder:

```{r}
# write_csv("../clean_data/shs_data_clean.csv")

```


## Analysis

### General Questions

We would like to to help us gain insights into how people feel about their local communities in Scotland. In particular, we are interested in the relationship between distance to outdoor space, and neighbourhood ratings.

    Are there certain groups that have local access to green space?
    Are there groups that are lacking access?
    What there big differences in how far people have to walk to access their green space?
    Are there any differences between rural and urban areas?
    
    How do people in neighbourhoods with good access to green space differ from those who have no good access? 
    Are there differences in how they rate their neighbourhoods? 
    Are there differences in how they rate their communities?
    
    Is there any way to predict which households would have higher ratings?


### Visualisation

Focus on age, gender, ethnicity, household type, simd quintiles, urban or rural, disabled, local authority, religion.

I am defining "local access" as 0-10 minutes because i think that seems reasonable and 11+ is open ended so could be an hour for example. Updaet: 5 minute walk is used in the national indicator.

```Are there certain groups that have local access to green space (<5min)? Are there groups that are lacking access (10+)?```

```{r}
# shs_data_la_join <- shs_data_clean %>% 
#   mutate(local_access = if_else(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less", "Local access", "No local access"), .after = walking_time_to_nearest_green_or_blue_space)

```

## Age 

```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = age, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = age, colour = age)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Mean % of people within 5 minutes or less of green space vs. age")

```

Interpretation:

Adults 35-64 years old age group have greater local access to green or blue space compared to (65+) elderly. The 16-34 year old age group generally ahve similar access to 35-64 however access is similar to elderly in 2015 and 2016 - currently unclear why.

```{r}
shs_data_clean %>% 
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value))

# H0 - There is no difference in the mean perc of 35-64 year old vs. 65 and over access to green/blue space within 5 min walk.

shs_age_data <- shs_data_clean %>% 
  filter(age != "All", age != "16-34 years") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>% 
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value))

null_distribution <- shs_age_data %>% 
  specify(mean_perc ~ age) %>% # the relationship being tested
  hypothesize(null = "independence") %>% # the null hypothesis is no relationship / independent
  generate(reps = 1000, type = "permute") %>% 
  calculate(stat = "diff in means", order = c("35-64 years", "65 years and over"))

null_distribution %>% slice_min(stat, n = 5)

head(null_distribution)

observed_stat <- shs_age_data %>% 
  specify(mean_perc ~ age) %>%
  calculate(stat = "diff in means", order = c("35-64 years", "65 years and over"))

null_distribution %>%
  visualise() +
  shade_p_value(direction = "both", obs_stat = observed_stat)

null_distribution %>%
  get_p_value(direction = "both", obs_stat = observed_stat)

```



```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(age) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = age, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = age, colour = age)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```



## Ethnicity

```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(ethnicity) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = ethnicity, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(ethnicity, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = ethnicity, colour = ethnicity)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

Interpetation:

White ethnicity have greater access than non-white and this trend is consistent albeit to varying degrees across the years 2013-2019.

```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(ethnicity) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = ethnicity, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(ethnicity, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = ethnicity, colour = ethnicity)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```


## Gender (note - these cats may have changed in recent years so review)

```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(gender != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(gender) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = gender, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(gender != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(gender, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = gender, colour = gender)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

Interpretation:

Males have greater access to local green or blue space and although this difference is marginal (~2%) it is a consitent trend across the years 2013-2019.


## Household type

```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(household_type) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = household_type, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  #filter(gender != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(household_type, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = household_type, colour = household_type)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

Interpretation:

Households with children have the greatest access to local green or blue space although this is marginally greater than adult only households. Pensions have the lowest access to local green or blue space. The trend across all household types is of decreasing access to outdoor space although the difference from start (2013) to end (2019) is marginal.

## SIMD

```{r}
shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  filter(simd_quintiles != "All") %>% 
  group_by(simd_quintiles) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = simd_quintiles, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(simd_quintiles != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(simd_quintiles, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = simd_quintiles, colour = simd_quintiles)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

Interpretation:

The 80% least deprived have greater access to local green or outdoor space then the 20% most deprived on the SIMD. This is consistent across all years, 2013-2019.

## Urban or rural

```{r}
shs_data_la_join %>% 
  #filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  filter(urban_rural_classification != "All") %>% 
  group_by(urban_rural_classification) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = urban_rural_classification, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_la_join %>% 
  #filter(measurement == "Percent") %>%
  filter(urban_rural_classification != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(urban_rural_classification, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = urban_rural_classification, colour = urban_rural_classification)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

Interpretation:

Respondents living in rural areas have greater access to local green or outdoor space than respondents living in urban areas. This is consistent across all years, 2013-2019.


## Local Authority (LA)

```{r}
shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  filter(la_name != "All") %>% 
  group_by(la_name) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = la_name, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  filter(la_name != "All") %>% 
  group_by(la_name) %>% 
  summarise(mean_perc = mean(value)) %>% 
  arrange(desc(mean_perc)) %>% 
  head(5)

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(la_name, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = la_name, colour = la_name)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  theme(legend.position = "False")

```

Interpretation:

The range of variation in access to local green or blue areas between local authority areas is ~55-85% (30%). The LA with least access is West Dunbartonshire 50.87037 and the are with greatest is East Lothian	83.92233.

```Are there big differences in how far people have to walk to access their green space?```

What is the time category proportion to green or blue space for the age groups with different access?

```{r}
shs_data_clean %>%
  filter(age != "All") %>% # want age bands
  group_by(age, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = age)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

What is the time category proportion to green or blue space for the ethnicity groups with different access?

```{r}
shs_data_clean %>%
  filter(ethnicity != "All") %>% # want age bands
  group_by(ethnicity, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = ethnicity)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

Gender

```{r}
shs_data_clean %>%
  filter(gender != "All") %>% # want age bands
  group_by(gender, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = gender)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

```{r}
shs_data_clean %>%
  filter(household_type != "All") %>% # want age bands
  group_by(household_type, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = household_type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```
```{r}
shs_data_clean %>%
  filter(simd_quintiles != "All") %>% # want age bands
  group_by(simd_quintiles, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = simd_quintiles)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```
```{r}
shs_data_clean %>%
  filter(urban_rural_classification != "All") %>% # want age bands
  group_by(urban_rural_classification, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = urban_rural_classification)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


For this plot to work it'll need to be with head 5 and/or tail 5 values.

```{r}
shs_data_clean %>%
  filter(age != "All") %>% # want age bands
  group_by(la_name, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = la_name)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


## Neighbourhood vs All ages

```{r}
shs_data_la_join %>% # only 446 rows
  filter(measurement == "Percent") %>%
  filter(age == "All") %>% 
  filter(!is.na(neighbourhood_rating)) %>% 
  group_by(neighbourhood_rating) %>% 
  summarise(hood_rating_count = n()) %>% 
  ggplot() +
  aes(x = neighbourhood_rating, y = hood_rating_count) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

# shs_data_la_join %>%# only 446 rows so doesn't really work
#   filter(measurement == "Percent") %>%
#   filter(age != "All") %>% 
#   filter(!is.na(neighbourhood_rating)) %>%
#   group_by(neighbourhood_rating, year) %>% 
#   summarise(hood_rating_count = n()) %>%  
#   ggplot() +
#   geom_line(aes(x = year, y = hood_rating_count, group = neighbourhood_rating, colour = neighbourhood_rating)) +
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

```{r}
# shs_data_la_join %>% # only 446 rows
#   filter(measurement == "Percent") %>%
#   filter(!is.na(household_type)) %>% 
#   group_by(neighbourhood_rating) %>% 
#   summarise(hood_rating_count = n()) %>% 
#   ggplot() +
#   aes(x = household_type, y = house_type_count) +
#   geom_col() +
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```



```{r}
shs_data_la_join %>%
  filter(gender != "NA" & gender != "All") %>%
  ggplot() +
  aes(x = gender, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>%
  filter(ethnicity != "All") %>%
  ggplot() +
  aes(x = ethnicity, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>%
  filter(household_type != "All") %>%
  ggplot() +
  aes(x = household_type, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>%
  filter(simd_quintiles != "All") %>%
  ggplot() +
  aes(x = simd_quintiles, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>% 
  distinct(urban_rural_classification)

```

What there big differences in how far people have to walk to access their green space?

```{r}
shs_data_la_join %>%
  filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  filter(walking_distance_to_nearest_greenspace != "All") %>% 
  ggplot() +
  aes(x = la_name, fill = walking_distance_to_nearest_greenspace) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

Are there any differences between rural and urban areas?

```{r}
shs_data_la_join %>%
  filter(urban_rural_classification != "All") %>%
  ggplot() +
  aes(x = urban_rural_classification, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) 

```

```{r}
dist_blue_green %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>% 
  group_by(ethnicity, date_code) %>% 
  summarise(mean_percentage = mean(value)) %>% 
  arrange(date_code)

```

```How do people in neighbourhoods with good access to green space differ from those who have no good access? ```

```{r}
shs_data_clean %>%
  filter(age != "All") %>% # want age bands
  group_by(age, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = age)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


```{r}
shs_data_clean %>%
  #filter(household_type != "All") %>% # want age bands
  group_by(household_type, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = household_type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

```{r}
shs_data_clean %>%
  filter(simd_quintiles != "All") %>% # want age bands
  group_by(simd_quintiles, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = simd_quintiles)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

```{r}
shs_data_clean %>%
  filter(la_name == "West Lothian") %>% 
  filter(year == "2013") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less")
```

```{r}

shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = age, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = age, colour = age)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Mean % of people within 5 minutes or less of green space vs. age")


```

