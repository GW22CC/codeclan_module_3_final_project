---
title: "R Notebook"
output: html_notebook
---

# Superseded code

## Greenspace vs age

```{r}
# Tom's code
# shs_responses_clean %>% 
#   group_by(distance_to_nearest_green_space) %>% 
#   count(age) %>%
#   mutate(n = n/sum(n)) %>% 
#   ggplot() + 
#   aes(x = distance_to_nearest_green_space, y = n, fill = age ) +
#   geom_col()

# shs_aggregate_responses_data_clean %>% # needs to be a proportion as varying number of annual respondents, unclear why 2012 different - olympic investment in Scotland?
#   filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
#   group_by(age, year) %>% 
#   summarise(total_respondents = sum(n_persons)) %>% 
#   ggplot() +
#   geom_line(aes(x = year, y = total_respondents, group = age, colour = age)) +
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#   ggtitle("Mean % of people within 5 minutes or less of green space vs. age")
# 
# shs_aggregate_responses_data_clean %>% 
#   filter(year == 2012) %>% 
#   distinct(walking_time_to_nearest_green_or_blue_space)

```

Is there a significant time trend in the proportion of young people within local access to green space? 

```{r}
# library(trend)
adult_trend_test <- shs_data_clean %>%
  filter(age != "All", age == "35-64 years") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value))

adult_perc <- ts(data = adult_trend_test %>% pull(mean_perc), start=2013)
bartels.test(adult_perc)

```

```{r}
trend_test_age <- shs_data_clean %>%
  filter(age != "All", age == "35-64 years") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(year) %>% 
  arrange(year)

time <- trend_test_age %>% pull(year)
perc_means <- trend_test_age %>% pull(value)
X0 <- time + perc_means

notrend_test(X0)

```




```{r}
dist_age_test <- shs_data_clean %>% 
  filter(age != "All", age == "16-34 years", walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>% 
  select(year, feature_code, value, age) %>% 
  

dist_age_test %>% 
  ggplot() +
  aes(x = year, y = value) +
  geom_point()

dist_age_test %>% 
  group_by(age, year) %>% 
  summarise(mean_val = mean(value),
            sd_val = sd(value),
            min_val = min(value),
            max_val = max(value),
            sample = n())
```

Testing the time series (year) linear trend of mean proportions within age group.

```{r}
# Testing for linear trend
notrend_test()

```


```{r}
dist_model <- dist_blue_green %>% 
  filter(measurement == "Percent", age == "35-64 years", distance_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  select(feature_code, date_code, value, gender, age, distance_to_nearest_green_or_blue_space) %>%
  group_by(date_code) %>% 
  summarise(mean_prop = mean(value)) %>% 
  ggplot() +
  aes(x = date_code, y = mean_prop) +
  geom_line()

```

### Statistical tests w/ Age

```{r}
shs_data_clean %>% 
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value))

# H0 - There is no difference in the mean perc of 35-64 year old vs. 65 and over access to green/blue space within 5 min walk.

shs_age_data <- shs_data_clean %>% 
  filter(age != "All", age != "16-34 years") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>% 
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value))

null_distribution <- shs_age_data %>% 
  specify(mean_perc ~ age) %>% # the relationship being tested
  hypothesize(null = "independence") %>% # the null hypothesis is no relationship / independent
  generate(reps = 1000, type = "permute") %>% 
  calculate(stat = "diff in means", order = c("35-64 years", "65 years and over"))

null_distribution %>% slice_min(stat, n = 5)

head(null_distribution)

observed_stat <- shs_age_data %>% 
  specify(mean_perc ~ age) %>%
  calculate(stat = "diff in means", order = c("35-64 years", "65 years and over"))

null_distribution %>%
  visualise() +
  shade_p_value(direction = "both", obs_stat = observed_stat)

null_distribution %>%
  get_p_value(direction = "both", obs_stat = observed_stat)

```



```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(age) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = age, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = age, colour = age)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

## Greenspace vs ethnicity

## Ethnicity 

```{r}
shs_proportions_data_clean %>%
  distinct(walking_time_to_nearest_green_or_blue_space)
  
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(ethnicity) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = ethnicity, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_proportions_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(ethnicity, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = ethnicity, colour = ethnicity)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_proportions_data_clean %>% 
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space != "All") %>% 
  group_by(ethnicity) %>% 
  count(walking_time_to_nearest_green_or_blue_space) %>% 
  mutate(Proportion = n/sum(n)*100) %>%
  ggplot() +
  aes(x = walking_time_to_nearest_green_or_blue_space, y = Proportion, fill = ethnicity) +
  geom_col(position = "dodge") +
  xlab(("Walking time (mins) to nearest green or blue space")) +
  ylab("Proportion (%) of respondents") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) #+
  scale_x_discrete(limits = c("A 5 minute walk or less", "Within a 6-10 minute walk", "Within an 11-20 minute walk","Within a 21-30 minute walk", "More than a 30 minute walk away", "Don't know"))

```

```{r}
shs_proportions_data_clean %>% 
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space != "All") %>%  
  filter(walking_time_to_nearest_green_or_blue_space != "Don't know") %>% 
  group_by(ethnicity) %>% 
  count(walking_time_to_nearest_green_or_blue_space) %>% 
  mutate(Proportion = n/sum(n)*100) %>%
  ggplot() +
  aes(x = walking_time_to_nearest_green_or_blue_space, y = Proportion, fill = ethnicity) +
  geom_col(position = "dodge") +
  xlab(("Walking time (mins) to nearest green or blue space")) +
  ylab("Proportion (%) of respondents") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) #+
  scale_x_discrete(limits = c("A 5 minute walk or less", "Within a 6-10 minute walk", "Within an 11-20 minute walk","Within a 21-30 minute walk", "More than a 30 minute walk away", "Don't know"))

```


```{r}
shs_proportions_data_clean %>% 
  filter(ethnicity == "Other") %>% 
  filter(!is.na(walking_time_to_nearest_green_or_blue_space)) %>% 
  filter(walking_time_to_nearest_green_or_blue_space != "All", walking_time_to_nearest_green_or_blue_space != "Don't know")

shs_proportions_data_clean %>%
  filter(ethnicity != "All", walking_time_to_nearest_green_or_blue_space != "All") %>% # want age bands
  group_by(walking_time_to_nearest_green_or_blue_space) %>% 
  count(ethnicity) %>% 
  mutate(proportion = n/sum(n)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = proportion, fill = ethnicity)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```


Interpetation:

White ethnicity have greater access than non-white and this trend is consistent albeit to varying degrees across the years 2013-2019. I think this is probably related to the fact that non-white demographic could have more recent generation of immigrant and if looking for work this would most likely be in urban areas where access rates are generally lower.

Literature might show this

```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(ethnicity) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = ethnicity, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(ethnicity != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "An 11 minute walk or more") %>%
  group_by(ethnicity, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = ethnicity, colour = ethnicity)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

## Greenspace vs. gender

```{r}
shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(gender != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(gender) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = gender, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(gender != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(gender, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = gender, colour = gender)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

## Green space vs. Household type

```{r}
shs_proportions_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(household_type) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = household_type, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

shs_proportions_data_clean %>% 
  #filter(measurement == "Percent") %>%
  #filter(gender != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(household_type, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = household_type, colour = household_type)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

What is the time category proportion to green or blue space for the age groups with different access?

```{r}
shs_data_clean %>%
  filter(age != "All") %>% # want age bands
  group_by(age, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = age)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

Gender

```{r}
shs_aggregate_responses_data_clean %>%
  filter(gender != "All") %>% # want age bands
  group_by(gender, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = gender)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

```{r}
shs_data_clean %>%
  filter(household_type != "All") %>% # want age bands
  group_by(household_type, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = household_type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


```{r}
shs_data_clean %>%
  filter(simd_quintiles != "All") %>% # want age bands
  group_by(simd_quintiles, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = simd_quintiles)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```



## Neighbourhood vs All ages

```{r}
shs_data_la_join %>% # only 446 rows
  filter(measurement == "Percent") %>%
  filter(age == "All") %>% 
  filter(!is.na(neighbourhood_rating)) %>% 
  group_by(neighbourhood_rating) %>% 
  summarise(hood_rating_count = n()) %>% 
  ggplot() +
  aes(x = neighbourhood_rating, y = hood_rating_count) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

# shs_data_la_join %>%# only 446 rows so doesn't really work
#   filter(measurement == "Percent") %>%
#   filter(age != "All") %>% 
#   filter(!is.na(neighbourhood_rating)) %>%
#   group_by(neighbourhood_rating, year) %>% 
#   summarise(hood_rating_count = n()) %>%  
#   ggplot() +
#   geom_line(aes(x = year, y = hood_rating_count, group = neighbourhood_rating, colour = neighbourhood_rating)) +
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

```{r}
# shs_data_la_join %>% # only 446 rows
#   filter(measurement == "Percent") %>%
#   filter(!is.na(household_type)) %>% 
#   group_by(neighbourhood_rating) %>% 
#   summarise(hood_rating_count = n()) %>% 
#   ggplot() +
#   aes(x = household_type, y = house_type_count) +
#   geom_col() +
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```



```{r}
shs_data_la_join %>%
  filter(gender != "NA" & gender != "All") %>%
  ggplot() +
  aes(x = gender, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>%
  filter(ethnicity != "All") %>%
  ggplot() +
  aes(x = ethnicity, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>%
  filter(household_type != "All") %>%
  ggplot() +
  aes(x = household_type, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>%
  filter(simd_quintiles != "All") %>%
  ggplot() +
  aes(x = simd_quintiles, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

shs_data_la_join %>% 
  distinct(urban_rural_classification)

```

What there big differences in how far people have to walk to access their green space?

```{r}
shs_data_la_join %>%
  filter(measurement == "Percent") %>%
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  filter(walking_distance_to_nearest_greenspace != "All") %>% 
  ggplot() +
  aes(x = la_name, fill = walking_distance_to_nearest_greenspace) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

Are there any differences between rural and urban areas?

```{r}
shs_data_la_join %>%
  filter(urban_rural_classification != "All") %>%
  ggplot() +
  aes(x = urban_rural_classification, y = local_access) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) 

```

```{r}
dist_blue_green %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>% 
  group_by(ethnicity, date_code) %>% 
  summarise(mean_percentage = mean(value)) %>% 
  arrange(date_code)

```


```{r}
shs_data_clean %>%
  filter(age != "All") %>% # want age bands
  group_by(age, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = age)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


```{r}
shs_data_clean %>%
  #filter(household_type != "All") %>% # want age bands
  group_by(household_type, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = household_type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```



```{r}
shs_data_clean %>%
  filter(simd_quintiles != "All") %>% # want age bands
  group_by(simd_quintiles, walking_time_to_nearest_green_or_blue_space) %>% 
  summarise(walking_time_count = mean(value)) %>% 
  ggplot(aes(x = walking_time_to_nearest_green_or_blue_space, y = walking_time_count, fill = simd_quintiles)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

```{r}
shs_data_clean %>%
  filter(la_name == "West Lothian") %>% 
  filter(year == "2013") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less")
```

```{r}

shs_data_clean %>%
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  aes(x = age, y = mean_perc) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

shs_data_clean %>% 
  #filter(measurement == "Percent") %>%
  filter(age != "All") %>% 
  filter(walking_time_to_nearest_green_or_blue_space == "A 5 minute walk or less") %>%
  group_by(age, year) %>% 
  summarise(mean_perc = mean(value)) %>% 
  ggplot() +
  geom_line(aes(x = year, y = mean_perc, group = age, colour = age)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Mean % of people within 5 minutes or less of green space vs. age")


```

Community belonging exploration:

```{r}
shs_data_clean %>% 
  filter(!is.na(community_belonging)) %>% 
  

```


## Logistic Regression

Explanatory model for people who responded with "" to community belonging (across all LA authorities for all years).

```{r}
shs_data_clean %>%
  filter(community_belonging == "Very strongly") %>%
  filter(gender != "All") %>% 
  select(community_belonging, la_name, year, gender) %>% 
  distinct()
  
```

```{r}
shs_agg_resp <- read_csv("../raw_data/shs_aggregate_responses.csv")

shs_agg_resp %>% 
  filter(!is.na(nearest_green_space_use))

shs_agg_resp %>% 
  group_by(year) %>% 
  summarise(n = n())

shs_agg_resp %>% 
  distinct(volunteering_last_twelve_months)

glimpse(shs_agg_resp)

```

# Modelling

Explanatory model

I will use logistic regression because all the variables, predictors and outcomes, are categorical.